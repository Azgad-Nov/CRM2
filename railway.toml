# =============================================================================
# Railway Configuration — CRM Doctor Backend (Flask + Gunicorn)
# =============================================================================
# This file configures the backend service. It is placed at the project root
# because the backend's build context needs access to app.py, backend/, and
# frontend/templates/ which are all at the root level.
#
# The frontend service uses its own config at frontend/railway.toml.
# Set the backend service's "Config File Path" to /railway.toml in the
# Railway dashboard (Service → Settings → General → Config File Path).
#
# Docs: https://docs.railway.com/reference/config-as-code
# =============================================================================

[build]
builder = "DOCKERFILE"
dockerfilePath = "backend/Dockerfile"
watchPatterns = [
    "app.py",
    "backend/**",
    "frontend/templates/**",
    "requirements.txt",
    "backend/Dockerfile"
]

[deploy]
startCommand = "gunicorn app:app --bind 0.0.0.0:$PORT --workers 2 --timeout 120 --access-logfile - --error-logfile -"
healthcheckPath = "/login"
healthcheckTimeout = 120
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 5

# Staging: fewer workers to save resources
[environments.staging.deploy]
startCommand = "gunicorn app:app --bind 0.0.0.0:$PORT --workers 1 --timeout 120 --access-logfile - --error-logfile -"

# Production: more workers for concurrent users
[environments.production.deploy]
startCommand = "gunicorn app:app --bind 0.0.0.0:$PORT --workers 4 --timeout 120 --access-logfile - --error-logfile -"
